```yaml
- title: "Initial Access Detection via Spearphishing Email"
  id: "b1c1e1a2-3f4d-4e5b-8c1e-1a2b3c4d5e6f"
  description: "Detects when a user opens a spearphishing email with a malicious attachment in Outlook."
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Name: "Outlook"
      dstNode.Name: "invoice.docx"
      relation: "Process Create"
  condition: selection
  tags:
    - T1566
    - Initial Access
  level: high
---
- title: "Execution of Malicious Document"
  id: "c2d2e2f3-4g5h-6i7j-8k9l-0m1n2o3p4q5r"
  description: "Monitors for the execution of macros in Microsoft Word when a malicious document is opened."
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Image: "C:\\Program Files\\Microsoft Office\\root\\OfficeXX\\WINWORD.EXE"
      dstNode.Image: "invoice.docx"
      relation: "Process Create"
  condition: selection
  tags:
    - T1059.003
    - Execution
  level: high
---
- title: "Capture PowerShell Command Execution"
  id: "d3e3f4g5-6h7i-8j9k-0l1m-2n3o4p5q6r7s"
  description: "Detects execution of PowerShell commands that download files from external URLs."
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
      dstNode.Name: "payload.ps1"
      relation: "Process Create"
  condition: selection
  tags:
    - T1059.001
    - Execution
  level: high
---
- title: "Monitor Payload Download and Execution"
  id: "e4f4g5h6-7i8j-9k0l-1m2n-3o4p5q6r7s8t"
  description: "Identifies events where the downloaded payload is executed."
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
      dstNode.Image: "C:\\Path\\To\\Downloaded\\payload.ps1"
      relation: "Process Create"
  condition: selection
  tags:
    - T1203
    - Execution
  level: high
---
- title: "Track Command and Control Communication"
  id: "f5g5h6i7-8j9k-0l1m-2n3o-4p5q6r7s8t9u"
  description: "Monitors for outbound connections to known malicious IPs or domains initiated by PowerShell."
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
      dstNode.Dstaddress: "malicious-c2.com"
      relation: "TCP Connect"
  condition: selection
  tags:
    - T1071.001
    - Command and Control
  level: high
---
- title: "Identify Secondary Payload Retrieval"
  id: "g6h6i7j8-9k0l-1m2n-3o4p-5q6r7s8t9u0v"
  description: "Detects PowerShell commands that download secondary payloads from the C2 server."
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
      dstNode.Name: "secondary_payload.exe"
      relation: "Process Create"
  condition: selection
  tags:
    - T1105
    - Command and Control
  level: high
---
- title: "Capture Execution of Secondary Payload"
  id: "h7i7j8k9-0l1m-2n3o-4p5q-6r7s8t9u0v1w"
  description: "Monitors for the execution of the secondary payload after it has been downloaded."
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
      dstNode.Image: "C:\\Users\\Victim\\Downloads\\secondary_payload.exe"
      relation: "Process Create"
  condition: selection
  tags:
    - T1203
    - Execution
  level: high
---
- title: "Detect Persistence Mechanisms"
  id: "i8j8k9l0-1m2n-3o4p-5q6r-7s8t9u0v1w2x"
  description: "Identifies changes to the registry or creation of scheduled tasks by the secondary payload."
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
      dstNode.Key: "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run"
      relation: "RegSetValue"
  condition: selection
  tags:
    - T1547.001
    - Persistence
  level: high
---
- title: "Monitor Lateral Tool Transfer"
  id: "j9k9l0m1-2n3o-4p5q-6r7s-8t9u0v1w2x3y"
  description: "Detects the use of tools like PsExec for lateral movement across the network."
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
      dstNode.Image: "C:\\Temp\\PsExec.exe"
      relation: "Process Create"
  condition: selection
  tags:
    - T1021.002
    - Lateral Movement
  level: high
---
- title: "Establish Control on Lateral Systems"
  id: "k0l1m2n3-4o5p-6q7r-8s9t-0u1v2w3x4y5z"
  description: "Monitors for remote management tool connections from unusual sources."
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
      dstNode.Dstaddress: "Target Machine IP"
      relation: "TCP Connect"
  condition: selection
  tags:
    - T1021.001
    - Lateral Movement
  level: high
```