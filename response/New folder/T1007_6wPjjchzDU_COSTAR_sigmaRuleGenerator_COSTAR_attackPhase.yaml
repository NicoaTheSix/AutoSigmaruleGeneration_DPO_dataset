```yaml
- title: Identify Initial Access via Email
  id: 123e4567-e89b-12d3-a456-426614174000
  description: Monitor for events where Outlook is used to send or receive emails with specific subject lines such as "Important Document" and capture email headers and attachment details, specifically looking for attachments named "Invoice_2023.xlsx".
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      EventID: 25
      Subject: "Important Document"
      AttachmentName: "Invoice_2023.xlsx"
  condition: selection
  tags:
    - T1566.001
    - Initial Access
  level: high

---
- title: Map Opening of Malicious Attachment
  id: 123e4567-e89b-12d3-a456-426614174001
  description: Detect when Microsoft Excel is launched with the command line indicating the opening of "Invoice_2023.xlsx" and look for events that indicate the execution of macros within the Excel file.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      EventID: 4688
      Image: "*\\EXCEL.EXE"
      CommandLine: "*Invoice_2023.xlsx*"
  condition: selection
  tags:
    - T1566.001
    - Initial Access
  level: medium

---
- title: Validate Macro Execution and Payload Download
  id: 123e4567-e89b-12d3-a456-426614174002
  description: Track PowerShell execution events that include commands resembling Invoke-WebRequest with URLs pointing to suspicious domains and ensure the command line includes parameters indicating the output file is being saved to a temporary directory.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      EventID: 4104
      CommandLine: "*Invoke-WebRequest*"
      URL: "http://malicious-server.com/payload.exe"
      OutputFile: "$env:TEMP\\payload.exe"
  condition: selection
  tags:
    - T1566.001
    - Execution
  level: high

---
- title: Capture Execution of the Malicious Payload
  id: 123e4567-e89b-12d3-a456-426614174003
  description: Monitor for process creation events where the executable file is payload.exe located in the temporary directory and validate that the process creation is initiated by PowerShell or Windows Explorer.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      EventID: 4688
      Image: "$env:TEMP\\payload.exe"
      ParentImage: "*\\powershell.exe"
  condition: selection
  tags:
    - T1566.001
    - Execution
  level: high

---
- title: Detect Establishing Persistence
  id: 123e4567-e89b-12d3-a456-426614174004
  description: Look for events related to the creation of scheduled tasks that reference schtasks commands with parameters indicating the execution of payload.exe on logon and monitor registry modifications that may indicate persistence mechanisms.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      EventID: 4698
      TaskName: "*payload.exe*"
      CommandLine: "*schtasks*"
  condition: selection
  tags:
    - T1566.001
    - Persistence
  level: medium

---
- title: Identify Data Exfiltration or Lateral Movement
  id: 123e4567-e89b-12d3-a456-426614174005
  description: Track PowerShell commands that include Invoke-WebRequest with POST methods targeting external servers and monitor network traffic logs for unusual outbound connections.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      EventID: 4104
      CommandLine: "*Invoke-WebRequest*"
      Method: "POST"
  condition: selection
  tags:
    - T1566.001
    - Exfiltration
  level: high
```