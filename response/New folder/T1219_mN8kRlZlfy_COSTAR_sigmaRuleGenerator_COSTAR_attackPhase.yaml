```yaml
- title: Identify Initial Access via Spearphishing Email
  id: 123e4567-e89b-12d3-a456-426614174000
  description: Monitor for the creation of emails with the subject line "Important: Invoice Attached" and log events related to the opening of emails that contain executable file types.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      Subject: "Important: Invoice Attached"
      FileType: ["exe", "bat", "cmd"]
  condition: selection
  tags:
    - T1566
    - Initial Access
  level: high

---
- title: Map Opening of the Malicious Attachment
  id: 123e4567-e89b-12d3-a456-426614174001
  description: Detect the execution of Microsoft Excel with the command line that includes the opening of `Invoice_2023.xlsx` and log the execution of macros, specifically looking for `Auto_Open()` in Excel files.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      ProcessName: "EXCEL.EXE"
      CommandLine: "*Invoice_2023.xlsx*"
  condition: selection
  tags:
    - T1203
    - Initial Access
  level: high

---
- title: Validate Execution of the Payload
  id: 123e4567-e89b-12d3-a456-426614174002
  description: Monitor for PowerShell commands that include `Invoke-WebRequest` to download files, particularly those targeting `http://malicious-site.com/payload.exe`, and log the creation of new executable files in the Downloads directory, specifically `payload.exe`.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      CommandLine: "*Invoke-WebRequest*http://malicious-site.com/payload.exe*"
  condition: selection
  tags:
    - T1059
    - Execution
  level: high

---
- title: Track Establishing Remote Access
  id: 123e4567-e89b-12d3-a456-426614174003
  description: Monitor for the creation of new Windows services, specifically looking for a service named `AnyDesk`, and log service installation events that indicate the command `sc create AnyDesk binPath= "C:\\Program Files\\AnyDesk\\AnyDesk.exe" start= auto` was executed.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      ServiceName: "AnyDesk"
      CommandLine: "sc create AnyDesk binPath= \"C:\\Program Files\\AnyDesk\\AnyDesk.exe\" start= auto"
  condition: selection
  tags:
    - T1071
    - Command and Control
  level: high

---
- title: Analyze Command and Control Communication
  id: 123e4567-e89b-12d3-a456-426614174004
  description: Monitor outbound network traffic for connections to the IP address `192.0.2.1` on port 443 and log any patterns indicative of command and control communications, especially those involving unusual ports or known malicious IP addresses.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      DestinationIP: "192.0.2.1"
      DestinationPort: 443
  condition: selection
  tags:
    - T1071
    - Command and Control
  level: high

---
- title: Detect Lateral Movement and Data Exfiltration
  id: 123e4567-e89b-12d3-a456-426614174005
  description: Monitor for unusual file access patterns and large outbound file transfers, particularly involving `confidential_data.zip`, and log AnyDesk sessions initiated from the compromised machine, especially those that include commands to send files to `192.0.2.1`.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      FileName: "confidential_data.zip"
      FileTransfer: true
  condition: selection
  tags:
    - T1041
    - Exfiltration
  level: high
```